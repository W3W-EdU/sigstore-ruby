#!/usr/bin/env ruby
# frozen_string_literal: true

require "tmpdir"

command = ARGV.shift

tmp = Dir.mktmpdir

exec({ "BUNDLE_GEMFILE" => File.expand_path("../Gemfile", __dir__),
       "RUBYOPT" => "-rbundler/setup #{ENV.fetch("RUBYOPT", nil)}",
       "HOME" => tmp,
       "XDG_DATA_HOME" => File.join(tmp, ".local", "share"),
       "XDG_CACHE_HOME" => File.join(tmp, ".cache") },
     Gem.ruby, "-S", "gem", "sigstore_cosign_#{command.tr("-", "_")}", *ARGV)
